<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Learning and Validation Hub</title>

    <!-- Load Tailwind CSS from CDN FIRST -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Configuration MUST come immediately after the CDN load -->
    <script>
        // Check if tailwind is available before configuring
        if (typeof tailwind !== 'undefined') {
            tailwind.config = {
                theme: {
                    extend: {
                        fontFamily: {
                            sans: ['Inter', 'sans-serif'],
                            mono: ['Source Code Pro', 'monospace'],
                        },
                        colors: {
                            'sql-blue': '#104e8b',
                            'sql-light': '#e8f0fe',
                            'ddl-red': '#dc2626',
                            'dml-blue': '#2563eb',
                            'dql-green': '#16a34a',
                            'dcl-purple': '#9333ea',
                            'tcl-amber': '#d97706',
                        }
                    }
                }
            };
        } else {
            console.warn("Tailwind object not found for configuration. Layout might be inconsistent.");
        }
    </script>
    <style>
        /* Import the Inter font for robustness */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Source+Code+Pro:wght@400;700&display=swap');

        body {
            background-color: #f4f7f9;
            font-family: 'Inter', sans-serif;
        }

        /* Styles specific to the SQL Tester and Navigation */
        .nav-button {
            @apply px-4 py-2 text-sm font-semibold rounded-lg transition duration-150 ease-in-out;
        }
        .nav-active {
            @apply bg-sql-light text-sql-blue shadow-md;
        }
        .nav-inactive {
            @apply text-gray-700 hover:bg-gray-100 hover:text-sql-blue;
        }

        .sql-box {
            @apply p-6 border border-gray-200 rounded-xl shadow-lg bg-white;
        }

        .icon-lg {
            width: 28px;
            height: 28px;
            fill: currentColor;
            vertical-align: middle;
            margin-right: 8px;
        }

        .key-tech {
            @apply p-4 rounded-xl text-center font-bold text-sql-blue bg-sql-light transition duration-300 ease-in-out hover:bg-sql-blue hover:text-white transform hover:scale-105;
        }
        
        .command-group-card {
            @apply sql-box transition duration-300 ease-in-out hover:shadow-xl;
        }
    </style>
</head>
<body class="min-h-screen">

    <header class="bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col md:flex-row justify-between items-center">
            <h1 class="text-3xl font-extrabold text-sql-blue flex items-center mb-4 md:mb-0">
                <svg class="icon-lg text-sql-blue mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                    <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                    <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                </svg>
                SQL LEARNING HUB
            </h1>
            <nav id="nav-container" class="flex flex-wrap justify-center gap-2">
                <!-- Navigation buttons will be injected here by JavaScript -->
            </nav>
        </div>
    </header>

    <main id="content-container" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <!-- Page content (Home, Tester, Read More) will be injected here -->
        <div class="text-center text-gray-500 mt-20">Loading content...</div>
    </main>

    <!-- Modal for Copy/Download Feedback -->
    <div id="modal-feedback" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center p-4 transition-opacity duration-300" onclick="this.classList.add('hidden')">
        <div class="bg-white p-6 rounded-xl shadow-2xl text-center transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full">
            <p id="modal-message" class="text-lg font-semibold text-sql-blue"></p>
            <button onclick="document.getElementById('modal-feedback').classList.add('hidden')" class="mt-4 inline-flex justify-center rounded-md border border-transparent px-4 py-2 bg-sql-blue text-base font-medium text-white shadow-sm hover:bg-sql-blue/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sql-blue sm:text-sm">
                Close
            </button>
        </div>
    </div>

    <script>
        // Global variables for dynamic content
        const pages = {
            'home': { title: 'Home', render: renderHomePage },
            'tester': { title: 'SQL Tester', render: renderTesterPage },
            'read-more': { title: 'Read More About SQL', render: renderReadMorePage },
        };
        let currentPage = 'home';
        let allSuggestions = []; // Array to hold all accumulated suggestions
        let showAllSuggestions = false; // Flag to toggle suggestion visibility

        // Firebase-like constants for the environment (since Firestore is not requested/needed here)
        // Leaving these as placeholders, as the app is client-side only.
        const __app_id = 'sql-learning-hub';
        const __firebase_config = '{}';
        const __initial_auth_token = 'none';

        // --- Core Application Logic ---

        function updateURL(page) {
            history.pushState({ page: page }, '', `#${page}`);
        }

        window.onpopstate = (event) => {
            if (event.state && event.state.page) {
                currentPage = event.state.page;
            } else {
                // Handle initial load or direct navigation to #hash
                const hash = window.location.hash.substring(1);
                currentPage = pages[hash] ? hash : 'home';
            }
            renderCurrentPage(false); // Render without pushing state again
        };

        function navigateTo(page) {
            currentPage = page;
            updateURL(page);
            renderCurrentPage();
        }

        function renderNav() {
            const navContainer = document.getElementById('nav-container');
            if (!navContainer) return;

            navContainer.innerHTML = Object.keys(pages).map(key => {
                const isActive = key === currentPage;
                const className = isActive ? 'nav-active' : 'nav-inactive';
                return `
                    <button onclick="navigateTo('${key}')" class="nav-button ${className}" id="nav-${key}">
                        ${pages[key].title}
                    </button>
                `;
            }).join('');
        }

        function renderCurrentPage(pushState = true) {
            const contentContainer = document.getElementById('content-container');
            if (!contentContainer) return;

            // Update URL only if pushState is true (i.e., not a back/forward event)
            if (pushState) {
                updateURL(currentPage);
            }

            // Render navigation bar
            renderNav();

            // Render page content
            contentContainer.innerHTML = '';
            pages[currentPage].render(contentContainer);
            window.scrollTo(0, 0); // Scroll to top on page change
        }

        // --- Page Renderer Functions ---

        function renderHomePage(container) {
            container.innerHTML = `
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-4xl font-bold text-gray-800 mb-8 text-center">SQL: The Universal Language of Data</h2>

                    <!-- What is SQL? -->
                    <div class="sql-box mb-8">
                        <h3 class="text-2xl font-semibold text-sql-blue flex items-center mb-4">
                            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                            </svg>
                            What is SQL?
                        </h3>
                        <p class="text-gray-600 leading-relaxed">
                            <strong>SQL (Structured Query Language)</strong> is a domain-specific language used in programming and designed for managing data held in a Relational Database Management System (RDBMS), or for stream processing in a Relational Data Stream Management System (RDSMS). It is the backbone for almost every application that requires persistent, structured data storage.
                        </p>
                    </div>

                    <!-- History -->
                    <div class="sql-box mb-8">
                        <h3 class="text-2xl font-semibold text-sql-blue flex items-center mb-4">
                            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            The History: When was it founded?
                        </h3>
                        <p class="text-gray-600 leading-relaxed">
                            SQL traces its origins back to the **early 1970s** at IBM, primarily created by Donald D. Chamberlin and Raymond F. Boyce. It was originally named **SEQUEL** (Structured English Query Language). It became an official ANSI standard in 1986 and an ISO standard in 1987, solidifying its place as the industry standard for data interaction.
                        </p>
                    </div>

                    <!-- Applications -->
                    <div class="sql-box mb-8">
                        <h3 class="text-2xl font-semibold text-sql-blue flex items-center mb-4">
                            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                <line x1="8" y1="21" x2="16" y2="21"></line>
                                <line x1="12" y1="17" x2="12" y2="21"></line>
                            </svg>
                            Where is it Used? (Applications)
                        </h3>
                        <ul class="list-disc list-inside text-gray-600 ml-4 space-y-2">
                            <li><strong>Web Applications:</strong> Storing user profiles, product catalogs, and transaction data for sites like e-commerce and social media.</li>
                            <li><strong>Business Intelligence (BI):</strong> Running complex analytical queries to generate reports and insights for strategic decision-making.</li>
                            <li><strong>Financial Systems:</strong> Ensuring the integrity and atomicity of monetary transactions and audit trails.</li>
                            <li><strong>Data Warehousing:</strong> Storing vast amounts of historical data used for long-term trend analysis.</li>
                        </ul>
                    </div>

                    <!-- Key Technologies -->
                    <div class="sql-box">
                        <h3 class="text-2xl font-semibold text-gray-800 flex items-center mb-6">
                            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="3" y1="9" x2="21" y2="9"></line>
                                <line x1="9" y1="21" x2="9" y2="9"></line>
                                <line x1="15" y1="21" x2="15" y2="9"></line>
                            </svg>
                            Key Technologies and Companies
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="key-tech">Oracle Database</div>
                            <div class="key-tech">MySQL</div>
                            <div class="key-tech">PostgreSQL</div>
                            <div class="key-tech">Microsoft SQL Server</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTesterPage(container) {
            container.innerHTML = `
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-4xl font-bold text-gray-800 mb-8 text-center">SQL Syntax & Style Tester</h2>
                    <p class="text-center text-gray-600 mb-8">Paste your raw SQL queries below for instant syntax validation, style checking, and automatic formatting.</p>

                    <!-- Input Area -->
                    <textarea id="query-input" rows="10" placeholder="Paste your raw SQL query here (e.g., select * from users where id = 1)..."
                        class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-sql-blue focus:ring-sql-blue font-mono text-sm shadow-inner transition duration-150 ease-in-out">
</textarea>

                    <!-- Action Buttons -->
                    <div class="flex flex-wrap gap-4 mt-4 justify-center">
                        <button id="run-button" onclick="checkQuery()"
                            class="flex-1 min-w-[150px] md:flex-none px-6 py-3 bg-sql-blue text-white font-bold rounded-xl shadow-lg hover:bg-sql-blue/90 focus:outline-none focus:ring-4 focus:ring-sql-light transition duration-150 ease-in-out">
                            <svg class="inline mr-2 -mt-0.5" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                            Run Query
                        </button>
                        <button onclick="clearInput()"
                            class="flex-1 min-w-[150px] md:flex-none px-6 py-3 bg-gray-200 text-gray-700 font-bold rounded-xl shadow-lg hover:bg-gray-300 transition duration-150 ease-in-out">
                            <svg class="inline mr-2 -mt-0.5" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                            Clear Input
                        </button>
                    </div>

                    <!-- Results Area -->
                    <div id="results-div" class="mt-8 hidden">
                        <div id="summary-div" class="mb-4">
                            <!-- Analysis summary (Success/Error banner) -->
                        </div>

                        <!-- Formatted Output Section -->
                        <div id="formatting-container" class="sql-box p-4 md:p-6">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">
                                <svg class="inline mr-2 -mt-0.5" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="4 7 4 17 20 17 20 7"></polyline>
                                    <line x1="9" y1="12" x2="15" y2="12"></line>
                                </svg>
                                Formatted Output
                            </h3>
                            <pre id="formatted-query-output" class="p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm font-mono whitespace-pre-wrap overflow-auto max-h-96"></pre>

                            <div class="flex flex-wrap gap-3 mt-4 justify-end">
                                <button id="copy-button" onclick="copyFormattedQuery()" disabled
                                    class="px-4 py-2 text-sm bg-gray-700 text-white rounded-lg shadow hover:bg-gray-800 transition duration-150 disabled:opacity-50">
                                    <svg class="inline mr-1" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                    </svg>
                                    Copy
                                </button>
                                <button id="download-button" onclick="downloadFormattedQuery()" disabled
                                    class="px-4 py-2 text-sm bg-gray-700 text-white rounded-lg shadow hover:bg-gray-800 transition duration-150 disabled:opacity-50">
                                    <svg class="inline mr-1" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    Download (.sql)
                                </button>
                            </div>
                        </div>

                        <!-- Suggestions and Fix Summary -->
                        <div class="mt-6">
                            <h3 class="text-xl font-semibold text-gray-800 mb-3 flex items-center">
                                <svg class="inline mr-2 -mt-0.5" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 15v-6m0-4h.01"></path>
                                </svg>
                                Analysis Details
                            </h3>
                            <div id="fix-summary-div" class="sql-box mb-4">
                                <!-- Fix summary and stats will be injected here -->
                            </div>
                            <div id="suggestions-container" class="sql-box p-4 md:p-6 border-yellow-300 bg-yellow-50 text-yellow-800">
                                <h4 class="text-lg font-bold mb-2 flex items-center text-yellow-900">
                                    <svg class="inline mr-2 -mt-0.5" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="12" y1="8" x2="12" y2="12"></line>
                                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                    </svg>
                                    Style Suggestions & Best Practices
                                </h4>
                                <ul id="suggestions-list" class="list-disc ml-5 space-y-1 text-sm">
                                    <!-- Suggestions will be populated here -->
                                </ul>
                                <button id="show-more-suggestions" onclick="toggleSuggestions()" class="mt-3 text-xs font-semibold text-yellow-700 hover:underline hidden">
                                    Show All Suggestions
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            // Cache DOM elements
            window.queryInput = document.getElementById('query-input');
            window.resultsDiv = document.getElementById('results-div');
            window.summaryDiv = document.getElementById('summary-div');
            window.formattedQueryOutput = document.getElementById('formatted-query-output');
            window.fixSummaryDiv = document.getElementById('fix-summary-div');
            window.suggestionsList = document.getElementById('suggestions-list');
            window.formattingContainer = document.getElementById('formatting-container');
            window.downloadButton = document.getElementById('download-button');
            window.copyButton = document.getElementById('copy-button');
            window.runButton = document.getElementById('run-button');

            // Initial check on load of the tester page to format the default content
            checkQuery();
        }

        function renderReadMorePage(container) {
            container.innerHTML = `
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-4xl font-bold text-gray-800 mb-8 text-center">The Five Pillars of SQL: Command Groups</h2>
                    <p class="text-center text-gray-600 mb-10">SQL commands are classified into five major groups, each controlling a different aspect of the database. Understanding these roles is key to mastering SQL.</p>

                    <div class="grid md:grid-cols-2 gap-6">

                        <!-- DDL -->
                        <div class="command-group-card border-t-4 border-ddl-red bg-red-50">
                            <h3 class="text-2xl font-bold text-ddl-red mb-3 flex items-center">
                                <svg class="inline mr-2" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.41"></path><polyline points="15 3 22 10 15 17"></polyline><line x1="8" y1="14" x2="22" y2="14"></line></svg>
                                1. DDL (Data Definition Language)
                            </h3>
                            <p class="text-gray-700 mb-3"><strong>Purpose:</strong> Used to define and manage the database structure or schema. DDL commands are auto-committed, meaning changes are permanent and **cannot be rolled back**.</p>
                            <p class="font-semibold text-ddl-red">Commands:</p>
                            <ul class="list-disc list-inside ml-4 text-sm text-gray-600">
                                <li><code>CREATE</code> (Table, Index, View)</li>
                                <li><code>ALTER</code> (Change schema of an object)</li>
                                <li><code>DROP</code> (Delete objects/schema permanently)</li>
                                <li><code>TRUNCATE</code> (Remove all records quickly)</li>
                                <li><code>RENAME</code> (Change the name of an object)</li>
                            </ul>
                            <div class="mt-4 p-2 bg-red-100 border-l-4 border-ddl-red rounded text-xs text-red-800">
                                <strong>Caution:</strong> DDL commands modify the schema itself and are typically irreversible.
                            </div>
                        </div>

                        <!-- DML -->
                        <div class="command-group-card border-t-4 border-dml-blue bg-sql-light">
                            <h3 class="text-2xl font-bold text-dml-blue mb-3 flex items-center">
                                <svg class="inline mr-2" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                                2. DML (Data Manipulation Language)
                            </h3>
                            <p class="text-gray-700 mb-3"><strong>Purpose:</strong> Used to manipulate data within the defined database objects (rows and columns). DML operations are **reversible** and need to be managed by TCL commands.</p>
                            <p class="font-semibold text-dml-blue">Commands:</p>
                            <ul class="list-disc list-inside ml-4 text-sm text-gray-600">
                                <li><code>INSERT</code> (Add new data rows)</li>
                                <li><code>UPDATE</code> (Modify existing data)</li>
                                <li><code>DELETE</code> (Remove specific rows)</li>
                                <li><code>MERGE</code> (Combine INSERT and UPDATE logic)</li>
                            </ul>
                            <div class="mt-4 p-2 bg-blue-100 border-l-4 border-dml-blue rounded text-xs text-blue-800">
                                <strong>Tip:</strong> Always use a <code>WHERE</code> clause with <code>UPDATE</code> and <code>DELETE</code>.
                            </div>
                        </div>

                        <!-- DQL -->
                        <div class="command-group-card border-t-4 border-dql-green bg-green-50">
                            <h3 class="text-2xl font-bold text-dql-green mb-3 flex items-center">
                                <svg class="inline mr-2" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                                3. DQL (Data Query Language)
                            </h3>
                            <p class="text-gray-700 mb-3"><strong>Purpose:</strong> Used purely for retrieving and fetching data from the database. It is a read-only language and does not modify data or schema.</p>
                            <p class="font-semibold text-dql-green">Command:</p>
                            <ul class="list-disc list-inside ml-4 text-sm text-gray-600">
                                <li><code>SELECT</code> (The core command for data retrieval)</li>
                            </ul>
                            <div class="mt-4 p-2 bg-green-100 border-l-4 border-dql-green rounded text-xs text-green-800">
                                <strong>Key:</strong> The most frequently used command, essential for Business Intelligence.
                            </div>
                        </div>

                        <!-- TCL -->
                        <div class="command-group-card border-t-4 border-tcl-amber bg-amber-50">
                            <h3 class="text-2xl font-bold text-tcl-amber mb-3 flex items-center">
                                <svg class="inline mr-2" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.74 1.74"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                                4. TCL (Transaction Control Language)
                            </h3>
                            <p class="text-gray-700 mb-3"><strong>Purpose:</strong> Manages transactions (atomic units of work) and ensures data integrity according to the ACID properties. It controls the DML commands.</p>
                            <p class="font-semibold text-tcl-amber">Commands:</p>
                            <ul class="list-disc list-inside ml-4 text-sm text-gray-600">
                                <li><code>COMMIT</code> (Make changes permanent)</li>
                                <li><code>ROLLBACK</code> (Undo changes since the last COMMIT or SAVEPOINT)</li>
                                <li><code>SAVEPOINT</code> (Create a point to partially ROLLBACK to)</li>
                            </ul>
                            <div class="mt-4 p-2 bg-amber-100 border-l-4 border-tcl-amber rounded text-xs text-amber-800">
                                <strong>Foundation:</strong> Critical for financial systems and multi-step data processing.
                            </div>
                        </div>

                        <!-- DCL -->
                        <div class="command-group-card md:col-span-2 border-t-4 border-dcl-purple bg-purple-50">
                            <h3 class="text-2xl font-bold text-dcl-purple mb-3 flex items-center">
                                <svg class="inline mr-2" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                                5. DCL (Data Control Language)
                            </h3>
                            <p class="text-gray-700 mb-3"><strong>Purpose:</strong> Controls database access and user permissions/security. These are system-level commands that determine who can perform DDL, DML, and DQL operations.</p>
                            <p class="font-semibold text-dcl-purple">Commands:</p>
                            <ul class="list-disc list-inside ml-4 text-sm text-gray-600">
                                <li><code>GRANT</code> (Give a user access privileges)</li>
                                <li><code>REVOKE</code> (Remove access privileges)</li>
                                <li><code>DENY</code> (Explicitly refuse a privilege)</li>
                            </ul>
                            <div class="mt-4 p-2 bg-purple-100 border-l-4 border-dcl-purple rounded text-xs text-purple-800">
                                <strong>Security:</strong> The layer that defines the "who" and "what" of data interaction.
                            </div>
                        </div>
                    </div>

                    <!-- TRUNCATE vs DELETE Comparison -->
                    <div class="sql-box mt-10 p-6 bg-gray-100 border-l-4 border-gray-500 shadow-xl">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4"><code>TRUNCATE</code> vs. <code>DELETE</code>: The Key Difference</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-bold text-lg text-ddl-red mb-2 flex items-center"><span class="bg-red-200 text-ddl-red rounded-full w-6 h-6 flex items-center justify-center mr-2 text-sm">D</span> TRUNCATE (DDL)</h4>
                                <ul class="list-disc list-inside ml-5 space-y-1 text-sm text-gray-700">
                                    <li><strong>Auto-COMMIT:</strong> Permanent change, NO rollback possible.</li>
                                    <li><strong>Speed:</strong> Extremely fast; it deallocates data pages.</li>
                                    <li><strong>Identity:</strong> Resets identity columns (e.g., auto-increment) to 1.</li>
                                    <li><strong>Where Clause:</strong> Not supported. Removes ALL rows.</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg text-dml-blue mb-2 flex items-center"><span class="bg-sql-light text-dml-blue rounded-full w-6 h-6 flex items-center justify-center mr-2 text-sm">M</span> DELETE (DML)</h4>
                                <ul class="list-disc list-inside ml-5 space-y-1 text-sm text-gray-700">
                                    <li><strong>Reversible:</strong> Can be undone via a <code>ROLLBACK</code>.</li>
                                    <li><strong>Speed:</strong> Slower; logs each deleted row individually.</li>
                                    <li><strong>Identity:</strong> Does NOT reset identity columns.</li>
                                    <li><strong>Where Clause:</strong> Supported. Allows removal of specific rows.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- SQL Validation and Formatting Logic ---

        const KEYWORDS = [
            'SELECT', 'FROM', 'WHERE', 'AND', 'OR', 'INSERT', 'INTO', 'VALUES',
            'UPDATE', 'SET', 'DELETE', 'JOIN', 'LEFT JOIN', 'RIGHT JOIN', 'INNER JOIN', 'FULL JOIN',
            'GROUP BY', 'ORDER BY', 'HAVING', 'LIMIT', 'OFFSET', 'AS', 'DISTINCT',
            'CREATE', 'TABLE', 'ALTER', 'DROP', 'TRUNCATE', 'RENAME', 'TO', 'ADD', 'COLUMN', 'MODIFY', 'CHANGE',
            'VARCHAR', 'INT', 'INTEGER', 'NUMERIC', 'DECIMAL', 'DATE', 'DATETIME', 'TEXT', 'NOT NULL', 'NULL', 'PRIMARY KEY', 'FOREIGN KEY', 'REFERENCES',
            'CHECK', 'DEFAULT', 'ON DELETE', 'ON UPDATE', 'VIEW', 'INDEX', 'TRIGGER',
            'COMMIT', 'ROLLBACK', 'SAVEPOINT',
            'GRANT', 'REVOKE', 'DENY',
            'LIKE', 'BETWEEN', 'IN', 'IS NULL', 'IS NOT NULL',
        ];

        const BREAK_BEFORE_KEYWORDS = [
            'FROM', 'WHERE', 'JOIN', 'LEFT JOIN', 'RIGHT JOIN', 'INNER JOIN', 'FULL JOIN',
            'GROUP BY', 'ORDER BY', 'HAVING', 'LIMIT', 'OFFSET',
            'INSERT', 'UPDATE', 'DELETE', 'CREATE', 'ALTER', 'DROP', 'TRUNCATE', 'RENAME',
            'VALUES', 'SET',
        ];

        const FUNCTIONS_TO_FIX = ['NOW', 'CURRENT_TIMESTAMP', 'GETDATE'];

        function formatQuery(rawSql) {
            let formatted = rawSql;
            let currentSuggestions = [];
            let totalFixes = 0;

            // 1. Ensure spacing around special characters like ( ) = > <
            formatted = formatted.replace(/([()=<>,;])/g, ' $1 ').replace(/\s+/g, ' ').trim();

            // 2. Convert keywords to uppercase and count fixes
            const keywordsLower = KEYWORDS.map(k => k.toLowerCase()).sort((a, b) => b.length - a.length); // Longest first
            keywordsLower.forEach(kw => {
                const regex = new RegExp(`\\b${kw}\\b`, 'gi');
                formatted = formatted.replace(regex, (match) => {
                    if (match !== kw.toUpperCase()) {
                        totalFixes++;
                    }
                    return kw.toUpperCase();
                });
            });

            // 3. Fix DDL ADD/MODIFY/CHANGE COLUMN syntax for clarity
            formatted = formatted.replace(/ALTER\s+TABLE\s+(\S+)\s+(ADD)\s+((?!COLUMN\s+)\S+)/gi, (match, table, verb, rest) => {
                if (verb.toUpperCase() === 'ADD') {
                    currentSuggestions.push(`For clarity, 'ADD' was corrected to 'ADD COLUMN' in table ${table}.`);
                    return `ALTER TABLE ${table} ADD COLUMN ${rest}`;
                }
                return match;
            });

            // 4. Fix function default parentheses (e.g., DEFAULT (NOW()) -> DEFAULT NOW())
            FUNCTIONS_TO_FIX.forEach(func => {
                const regex = new RegExp(`DEFAULT\\s+\\(\\s*(${func})\\s*\\)`, 'gi');
                formatted = formatted.replace(regex, (match, funcName) => {
                    currentSuggestions.push(`Removed unnecessary parentheses from 'DEFAULT ${funcName.toUpperCase()}()'.`);
                    return `DEFAULT ${funcName.toUpperCase()}`;
                });
            });

            // 5. Add line breaks before major clauses
            BREAK_BEFORE_KEYWORDS.forEach(kw => {
                const regex = new RegExp(`\\s+${kw}\\s+`, 'g');
                formatted = formatted.replace(regex, `\n${kw} `);
            });

            // 6. Add line breaks after commas for column separation
            // This is complex to do perfectly, so we focus on commas not inside parentheses/strings.
            // Simple approach: replace any comma followed by a non-newline space with a comma and newline.
            formatted = formatted.replace(/,(\s*)(?!\n)/g, ',\n');

            // 7. Indentation and cleanup
            const lines = formatted.split('\n');
            let indentLevel = 0;
            const indentChar = '    ';
            const finalLines = [];

            lines.forEach(line => {
                let trimmedLine = line.trim();
                if (!trimmedLine) return;

                // Decrease indent for closing parentheses or clauses
                if (trimmedLine.match(/^\)/) || trimmedLine.match(/END;?$/) || trimmedLine.startsWith('ELSE')) {
                    indentLevel = Math.max(0, indentLevel - 1);
                }
                if (trimmedLine.startsWith('CREATE') || trimmedLine.startsWith('ALTER') || trimmedLine.startsWith('SELECT')) {
                    indentLevel = 0; // Reset indent for new statement
                }

                // Apply indentation
                finalLines.push(indentChar.repeat(indentLevel) + trimmedLine);

                // Increase indent for opening parentheses or clauses
                if (trimmedLine.match(/\($/) || trimmedLine.startsWith('BEGIN') || trimmedLine.startsWith('AS')) {
                    indentLevel++;
                }
                if (trimmedLine.startsWith('SELECT') || trimmedLine.startsWith('INSERT INTO')) {
                    indentLevel++;
                }

                // Simple adjustment for multi-line SELECT/FROM/WHERE
                if (trimmedLine.startsWith('FROM') || trimmedLine.startsWith('WHERE')) {
                    indentLevel++;
                }
                if (trimmedLine.startsWith('ORDER BY') || trimmedLine.startsWith('GROUP BY')) {
                    indentLevel++;
                }
            });

            // Replace multiple newlines with single newlines
            let finalOutput = finalLines.join('\n').replace(/\n\s*\n/g, '\n\n').trim();

            // Ensure every statement ends with a semicolon
            const statements = finalOutput.split(';');
            finalOutput = statements.map(s => s.trim()).filter(s => s.length > 0).join(';\n') + ';';

            return { formatted: finalOutput, suggestions: currentSuggestions, totalFixes };
        }

        function checkForCriticalErrors(rawSql) {
            let error = null;
            let cleanedSql = rawSql.toUpperCase().replace(/\s+/g, ' ');

            // 1. Missing initial keyword
            const startsWithKeyword = KEYWORDS.some(kw => cleanedSql.startsWith(kw));
            if (!startsWithKeyword) {
                error = "ERROR: The query must start with a valid SQL command (SELECT, CREATE, INSERT, etc.).";
            }

            // 2. Missing DDL comma (e.g., INT NOT NULL ADD COLUMN)
            // Look for a type/constraint followed by another DDL keyword without a comma or closing parenthesis in between.
            const ddlTypes = ['VARCHAR', 'INT', 'INTEGER', 'NUMERIC', 'DECIMAL', 'DATE', 'TEXT'];
            const ddlRegex = new RegExp(`(${ddlTypes.join('|')})(\\s+NOT\\s+NULL)?(\\s+NULL)?(\\s+PRIMARY\\s+KEY)?\\s+(ADD|MODIFY|CHANGE)`, 'i');
            if (ddlRegex.test(rawSql)) {
                error = "CRITICAL DDL ERROR: Found a DDL statement (e.g., INT NOT NULL ADD) without a separating comma or closing parenthesis. DDL elements must be separated.";
            }

            // 3. Simple SQL injection vulnerability detection (suggestion, not error)
            if (rawSql.includes("' OR '1'='1")) {
                error = "SECURITY WARNING: SQL Injection pattern detected (' OR '1'='1'). Always use parameterized queries or prepared statements to prevent this.";
            }

            return error;
        }

        function checkQuery() {
            if (!window.queryInput) return;

            const rawSql = window.queryInput.value.trim();
            allSuggestions = [];
            showAllSuggestions = false;
            window.resultsDiv.classList.add('hidden');
            window.summaryDiv.textContent = '';
            window.formattedQueryOutput.textContent = '';
            window.fixSummaryDiv.innerHTML = '';
            window.suggestionsList.innerHTML = '';
            window.downloadButton.disabled = true;
            window.copyButton.disabled = true;

            if (rawSql === '' || rawSql.length < 5) {
                clearInput();
                return;
            }

            window.runButton.disabled = true;
            window.runButton.textContent = 'Analyzing...';

            // --- Async simulation for processing large query (optional, for UX) ---
            setTimeout(() => {
                processQuery(rawSql);
                window.runButton.disabled = false;
                window.runButton.innerHTML = '<svg class="inline mr-2 -mt-0.5" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>Run Query';
            }, 100);
        }

        function processQuery(rawSql) {
            window.resultsDiv.classList.remove('hidden');

            const criticalError = checkForCriticalErrors(rawSql);

            if (criticalError) {
                window.summaryDiv.className = 'mt-6 p-4 rounded-lg text-center font-medium shadow-inner bg-red-100 text-red-700';
                window.summaryDiv.textContent = `‚ùå Critical Error Found: ${criticalError}`;
                window.formattingContainer.classList.add('hidden');
            } else {
                const { formatted, suggestions: formatSuggestions, totalFixes } = formatQuery(rawSql);

                // Additional Best Practice Suggestions
                const statements = rawSql.split(';').map(s => s.trim()).filter(s => s.length > 0);
                const totalStatements = statements.length;

                if (rawSql.toLowerCase().includes('select *')) {
                    allSuggestions.push({ type: 'warning', text: "Avoid using 'SELECT *' in production code. It can slow down queries, increase network traffic, and make your code brittle if column order changes. Explicitly list the columns you need." });
                }
                if (rawSql.toLowerCase().includes('delete from')) {
                    allSuggestions.push({ type: 'best_practice', text: "If you need to remove ALL rows, consider using 'TRUNCATE TABLE' instead of 'DELETE FROM' without a WHERE clause for better performance (DDL vs DML distinction applies). Remember TRUNCATE is irreversible." });
                }
                if (rawSql.toLowerCase().includes('like')) {
                    allSuggestions.push({ type: 'best_practice', text: "For case-insensitive string matching, use 'ILIKE' instead of 'LOWER(column) LIKE...' (PostgreSQL/MySQL support). If not supported, consider a case-insensitive collation." });
                }
                if (rawSql.toLowerCase().includes('insert') && !rawSql.toLowerCase().includes('(column_list)')) {
                    allSuggestions.push({ type: 'best_practice', text: "When using 'INSERT INTO', always explicitly list the column names, even if inserting all columns. This prevents code breakage if the table schema changes." });
                }

                // Combine format-specific suggestions with general best practices
                allSuggestions = formatSuggestions.map(text => ({ type: 'style_fix', text })).concat(allSuggestions);

                window.formattedQueryOutput.textContent = formatted;
                window.downloadButton.disabled = false;
                window.copyButton.disabled = false;
                window.formattingContainer.classList.remove('hidden');

                showFixSummary(rawSql, totalStatements, totalFixes);
                updateSuggestionsDisplay();

                window.summaryDiv.className = 'mt-6 p-4 rounded-lg text-center font-medium shadow-inner bg-green-100 text-green-700';
                window.summaryDiv.textContent = `‚úÖ Analysis Complete: ${totalStatements} statements checked and successfully formatted. No critical syntax errors found.`;
            }
        }

        function showFixSummary(rawSql, totalStatements, totalFixes) {
            const charCount = rawSql.length;
            const lineCount = rawSql.split('\n').length;
            const wordCount = rawSql.split(/\s+/).filter(word => word.length > 0).length;

            window.fixSummaryDiv.innerHTML = `
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h4 class="text-lg font-bold text-gray-800 mb-3 border-b pb-2">Query Statistics</h4>
                    <div class="grid grid-cols-2 gap-3 text-sm text-gray-700">
                        <div class="font-medium">Total Statements: <span class="text-sql-blue">${totalStatements}</span></div>
                        <div class="font-medium">Characters (Raw): <span class="text-sql-blue">${charCount}</span></div>
                        <div class="font-medium">Lines (Raw): <span class="text-sql-blue">${lineCount}</span></div>
                        <div class="font-medium">Keywords/Words: <span class="text-sql-blue">${wordCount}</span></div>
                    </div>
                </div>
                <div class="mt-4 p-4 bg-sql-light rounded-lg">
                    <h4 class="text-lg font-bold text-sql-blue mb-2">Style Correction Summary</h4>
                    <p class="text-sm text-gray-700"><strong>${totalFixes}</strong> automatic style fixes were applied, primarily focused on keyword capitalization and adding line breaks for clause separation.</p>
                </div>
            `;
        }

        function updateSuggestionsDisplay() {
            window.suggestionsList.innerHTML = '';
            const listLimit = 3;
            const displaySuggestions = showAllSuggestions ? allSuggestions : allSuggestions.slice(0, listLimit);

            displaySuggestions.forEach(s => {
                const icon = s.type === 'warning' ? '‚ö†Ô∏è' : (s.type === 'best_practice' ? '‚ú®' : 'üìù');
                const li = document.createElement('li');
                li.className = 'text-gray-700';
                li.innerHTML = `<span class="mr-2">${icon}</span>${s.text}`;
                window.suggestionsList.appendChild(li);
            });

            const showMoreButton = document.getElementById('show-more-suggestions');
            if (allSuggestions.length > listLimit) {
                showMoreButton.classList.remove('hidden');
                showMoreButton.textContent = showAllSuggestions ? 'Hide Less Important Suggestions' : `Show All ${allSuggestions.length} Suggestions`;
            } else {
                showMoreButton.classList.add('hidden');
            }
        }

        function toggleSuggestions() {
            showAllSuggestions = !showAllSuggestions;
            updateSuggestionsDisplay();
        }

        function clearInput() {
            if (!window.queryInput) return;
            window.queryInput.value = '';
            if (window.resultsDiv) window.resultsDiv.classList.add('hidden');
            if (window.suggestionsList) window.suggestionsList.innerHTML = '';
            if (window.summaryDiv) window.summaryDiv.textContent = '';
            if (window.formattedQueryOutput) window.formattedQueryOutput.textContent = '';
            if (window.fixSummaryDiv) window.fixSummaryDiv.innerHTML = '';
            if (window.formattingContainer) window.formattingContainer.classList.remove('hidden');
            if (window.downloadButton) window.downloadButton.disabled = true;
            if (window.copyButton) window.copyButton.disabled = true;
            allSuggestions = [];
            showAllSuggestions = false;
            // Run checkQuery to clear the last state and show an empty state.
            // Note: Since input is empty, it will call clearInput() again which is safe.
            checkQuery();
        }

        function copyFormattedQuery() {
            if (!window.formattedQueryOutput || window.formattedQueryOutput.textContent.trim() === '') return;
            const text = window.formattedQueryOutput.textContent;
            try {
                // Use execCommand for better iFrame compatibility
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = text;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                document.execCommand('copy');
                document.body.removeChild(tempTextArea);

                showModal('Query Copied!', 'The formatted SQL has been copied to your clipboard.');
            } catch (err) {
                console.error('Could not copy text: ', err);
                showModal('Copy Failed', 'Unable to copy text. Please select and copy manually.');
            }
        }

        function downloadFormattedQuery() {
            if (!window.formattedQueryOutput || window.formattedQueryOutput.textContent.trim() === '') return;
            const text = window.formattedQueryOutput.textContent;
            const filename = 'formatted_query.sql';

            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);

            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);

            showModal('Download Started', `Downloading file: ${filename}`);
        }

        function showModal(title, message) {
            const modal = document.getElementById('modal-feedback');
            const modalMessage = document.getElementById('modal-message');

            if (modal && modalMessage) {
                modalMessage.innerHTML = `<span class="text-xl font-bold">${title}</span><br>${message}`;
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                setTimeout(() => {
                    modal.classList.remove('flex');
                    modal.classList.add('hidden');
                }, 3000); // Hide after 3 seconds
            }
        }

        // --- Initialization ---\
        window.onload = () => {
            // Check hash for initial page state
            const hash = window.location.hash.substring(1);
            currentPage = pages[hash] ? hash : 'home';
            renderCurrentPage(false); // Render without pushing state on initial load
        };

    </script>
</body>
</html>
